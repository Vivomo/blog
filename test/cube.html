<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="../css/cube.css"/>
    <script src="../js/avalon.js"></script>

</head>

<body>
<div ms-controller="cube" class="outer-wrap">

    <div class="outer-box">
        <div ms-repeat="cubes" class="cubes"
             ms-attr-id="'id_'+$index"
             ms-css-transform="translate3d({{el.x}}px, {{el.y}}px, {{el.z}}px) rotateX({{el.rotateX}}deg) rotateY({{el.rotateY}}deg) rotateZ({{el.rotateZ}}deg)"
             ms-css-transform-origin="{{el.originX}}px {{el.originY}}px {{el.originZ}}px"
             ms-attr-data-role="role($index)"
             ms-attr-data-side="side($index)"
             ms-attr-data-position="position($index)">
            {{el.x}},{{el.y}},{{el.z}} <br>
            {{el.rotateX}}, {{el.rotateY}}, {{el.rotateZ}}
            <div class="front face" ms-css-background="bg($index,'front')" ></div>
            <div class="left face" ms-css-background="bg($index,'left')"></div>
            <div class="up face" ms-css-background="bg($index,'up')"></div>
            <div class="right face" ms-css-background="bg($index,'right')"></div>
            <div class="back face" ms-css-background="bg($index,'back')"></div>
            <div class="bottom face" ms-css-background="bg($index,'bottom')"></div>
        </div>
    </div>

</div>
<script>

    Math.radian = function(degree) {
        return degree * Math.PI / 180;
    };
    let cos = function(degree) {
        return Math.cos(Math.radian(degree));
    };
    let sin = function(degree) {
        return Math.sin(Math.radian(degree));
    };

    let colorMap = {
            up : 'yellow',
            bottom : 'white',
            left : 'orange',
            right : 'red',
            front : 'blue',
            back : 'green'
        },
        up = [],
        bottom = [],
        left = [],
        right = [],
        front = [],
        back = [],
        cubeWidth = 100;



    let CubeUtil = {
        front : 32, // 100000
        back : 16, //  010000
        up : 8,
        bottom : 4,
        left : 2,
        right : 1,
        getMark: function (mark) {
            const markObj = {};
            ['front', 'back', 'up', 'bottom', 'left', 'right'].forEach((item) => {
                markObj[item] = mark & CubeUtil[item];
            });
            return markObj;
        },
        createCubes: () => {
            return avalon.range(0, 27).map((index) => {
                let x = (index % 3 - 1) * cubeWidth,
                    y = ~~(index % 9 / 3) * cubeWidth - cubeWidth,
                    z = ~~(index / 9) * cubeWidth - cubeWidth;

                let originX = getOrigin(x),
                    originY = getOrigin(y),
                    originZ = getOrigin(z, true, index);

                return {
                    index,
                    x,
                    y,
                    z,
                    originX,
                    originY,
                    originZ,
                    rotateX: 0,
                    rotateY: 0,
                    rotateZ: 0,
                };
            })
        }
    };

    CubeUtil.xDirection = [CubeUtil.front, CubeUtil.up, CubeUtil.back, CubeUtil.bottom];
    CubeUtil.yDirection = [CubeUtil.front, CubeUtil.left, CubeUtil.back, CubeUtil.right];
    CubeUtil.zDirection = [CubeUtil.up, CubeUtil.right, CubeUtil.bottom, CubeUtil.left];


    function getOrigin(translate, isZ = false, index) {
        if (isZ) {
            return index < 9 ? cubeWidth :
                index < 18 ? 0 : -cubeWidth;
        }
        return -translate + cubeWidth / 2;
    }

    let vm = avalon.define({
        $id: 'cube',
        cubes: CubeUtil.createCubes(),
        up : up,
        bottom : bottom,
        left : left,
        right : right,
        front : front,
        back : back,
        transform: avalon.range(0, 27).map(function () {
            return 'translate3d(0px, 0px, 0px) rotateX(0deg) rotateY(0deg) rotateZ(0deg)';
        }),
        getTransform: function (index) {
            return vm.transform[index];
        },

        /**
         * 标记方块属于那一个边
         * 000000  前后上下左右
         * @param index
         */
        side : function(index) {
            let mark = 0;
            let cube = vm.cubes[index];
            if (cube.z == -cubeWidth)
                mark |= CubeUtil.back;
            if (cube.z == cubeWidth)
                mark |= CubeUtil.front;
            if (cube.x == -cubeWidth)
                mark |= CubeUtil.left;
            if (cube.x == cubeWidth)
                mark |= CubeUtil.right;
            if (cube.y == -cubeWidth)
                mark |= CubeUtil.up;
            if (cube.y == cubeWidth)
                mark |= CubeUtil.bottom;

            if (cube.rotateX !== 0) {

            }
            return mark;
        },

        bg : function (index, key) {
            let arr = vm[key];
            for (let i = 0; i < arr.length; i++) {
                if (arr[i].index === index)
                    return colorMap[key]
            }
        }
    });
    avalon.scan();



</script>
</body>
</html>